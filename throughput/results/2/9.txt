BEGIN;
BEGIN
select
	nation,
	o_year,
	sum(amount) as sum_profit
from
	(
		select
			n_name as nation,
			extract(year from o_orderdate) as o_year,
			l_extendedprice * (1 - l_discount) - ps_supplycost * l_quantity as amount
		from
			part,
			supplier,
			lineitem,
			partsupp,
			orders,
			nation
		where
			s_suppkey = l_suppkey
			and ps_suppkey = l_suppkey
			and ps_partkey = l_partkey
			and p_partkey = l_partkey
			and o_orderkey = l_orderkey
			and s_nationkey = n_nationkey
			and p_name like '%midnight%'
	) as profit
group by
	nation,
	o_year
order by
	nation,
	o_year desc;
          nation           | o_year |    sum_profit    
---------------------------+--------+------------------
 ALGERIA                   |   1998 | 2749740282.97223
 ALGERIA                   |   1997 |  4689989014.9833
 ALGERIA                   |   1996 | 4694811903.21634
 ALGERIA                   |   1995 | 4691266883.07654
 ALGERIA                   |   1994 | 4679689378.53686
 ALGERIA                   |   1993 | 4674606856.87476
 ALGERIA                   |   1992 | 4699517075.75229
 ARGENTINA                 |   1998 | 2683798331.37755
 ARGENTINA                 |   1997 |  4629085317.7626
 ARGENTINA                 |   1996 | 4604530866.66431
 ARGENTINA                 |   1995 | 4589250148.83906
 ARGENTINA                 |   1994 |  4604708041.9377
 ARGENTINA                 |   1993 |  4619218237.5658
 ARGENTINA                 |   1992 | 4643909949.47452
 BRAZIL                    |   1998 |  2738445107.6234
 BRAZIL                    |   1997 | 4655316015.51398
 BRAZIL                    |   1996 | 4691162640.64357
 BRAZIL                    |   1995 |  4673254271.7904
 BRAZIL                    |   1994 | 4685557656.18037
 BRAZIL                    |   1993 | 4693691615.12563
 BRAZIL                    |   1992 | 4675451835.73689
 CANADA                    |   1998 | 2737119150.78754
 CANADA                    |   1997 | 4677109695.02921
 CANADA                    |   1996 | 4684023171.46702
 CANADA                    |   1995 | 4668075939.56252
 CANADA                    |   1994 | 4664242571.78419
 CANADA                    |   1993 | 4674108939.26425
 CANADA                    |   1992 | 4680275539.01901
 CHINA                     |   1998 | 2734344451.61592
 CHINA                     |   1997 | 4655672232.16344
 CHINA                     |   1996 |  4698752051.7544
 CHINA                     |   1995 | 4668212205.17429
 CHINA                     |   1994 | 4682060005.43272
 CHINA                     |   1993 | 4671683323.70187
 CHINA                     |   1992 | 4684957327.64111
 EGYPT                     |   1998 | 2704396053.00135
 EGYPT                     |   1997 | 4605077642.87124
 EGYPT                     |   1996 | 4652714454.36386
 EGYPT                     |   1995 | 4637955961.48198
 EGYPT                     |   1994 | 4645343229.91959
 EGYPT                     |   1993 | 4648923233.96758
 EGYPT                     |   1992 | 4667202521.15462
 ETHIOPIA                  |   1998 | 2738191694.17836
 ETHIOPIA                  |   1997 | 4676304724.26884
 ETHIOPIA                  |   1996 | 4695651268.46679
 ETHIOPIA                  |   1995 | 4680849701.57482
 ETHIOPIA                  |   1994 | 4706094615.91311
 ETHIOPIA                  |   1993 | 4679442594.26419
 ETHIOPIA                  |   1992 | 4708342457.16418
 FRANCE                    |   1998 | 2736790808.07625
 FRANCE                    |   1997 | 4689791006.77015
 FRANCE                    |   1996 | 4708834283.46193
 FRANCE                    |   1995 | 4691513833.46519
 FRANCE                    |   1994 |  4693479738.5226
 FRANCE                    |   1993 | 4675654277.86394
 FRANCE                    |   1992 | 4690517778.60916
 GERMANY                   |   1998 | 2744341698.67921
 GERMANY                   |   1997 |  4692637297.0881
 GERMANY                   |   1996 | 4690945784.08357
 GERMANY                   |   1995 | 4701164282.74163
 GERMANY                   |   1994 | 4690005971.73163
 GERMANY                   |   1993 | 4697148868.67268
 GERMANY                   |   1992 | 4705937069.36483
 INDIA                     |   1998 |  2733562383.3505
 INDIA                     |   1997 |  4657516570.4576
 INDIA                     |   1996 | 4682025545.25178
 INDIA                     |   1995 | 4642211846.71735
 INDIA                     |   1994 |   4660852297.392
 INDIA                     |   1993 | 4658110852.73699
 INDIA                     |   1992 | 4678691708.11895
 INDONESIA                 |   1998 | 2726736067.91376
 INDONESIA                 |   1997 | 4617640506.57757
 INDONESIA                 |   1996 | 4648668377.26798
 INDONESIA                 |   1995 | 4621832815.76917
 INDONESIA                 |   1994 | 4635025719.24502
 INDONESIA                 |   1993 | 4649488520.77425
 INDONESIA                 |   1992 | 4647586347.87774
 IRAN                      |   1998 | 2730322148.29351
 IRAN                      |   1997 | 4646220175.20348
 IRAN                      |   1996 | 4683518662.56002
 IRAN                      |   1995 | 4663444828.64808
 IRAN                      |   1994 | 4669554428.57417
 IRAN                      |   1993 |  4637298716.3249
 IRAN                      |   1992 |  4664986334.2333
 IRAQ                      |   1998 | 2718099390.53338
 IRAQ                      |   1997 | 4623956439.54798
 IRAQ                      |   1996 | 4667152788.04447
 IRAQ                      |   1995 | 4636620902.19091
 IRAQ                      |   1994 | 4629915827.80216
 IRAQ                      |   1993 | 4614884265.19582
 IRAQ                      |   1992 | 4638193255.84485
 JAPAN                     |   1998 | 2712693512.08049
 JAPAN                     |   1997 | 4637139455.07767
 JAPAN                     |   1996 | 4657107890.58829
 JAPAN                     |   1995 | 4640616034.03431
 JAPAN                     |   1994 | 4653944955.61609
 JAPAN                     |   1993 | 4630526107.14244
 JAPAN                     |   1992 | 4651426768.77963
 JORDAN                    |   1998 | 2696425308.49595
 JORDAN                    |   1997 | 4632126711.63874
 JORDAN                    |   1996 | 4637640983.31568
 JORDAN                    |   1995 | 4622581859.42123
 JORDAN                    |   1994 | 4627020275.93451
 JORDAN                    |   1993 |  4602235306.0848
 JORDAN                    |   1992 | 4636524243.74447
 KENYA                     |   1998 | 2709016585.25651
 KENYA                     |   1997 | 4648312187.23358
 KENYA                     |   1996 |   4652935284.847
 KENYA                     |   1995 | 4633927939.70712
 KENYA                     |   1994 | 4609411269.23936
 KENYA                     |   1993 | 4629660184.94059
 KENYA                     |   1992 | 4631610852.08681
 MOROCCO                   |   1998 | 2758115117.35391
 MOROCCO                   |   1997 | 4686683352.98691
 MOROCCO                   |   1996 |  4695980907.5009
 MOROCCO                   |   1995 | 4671676663.33094
 MOROCCO                   |   1994 | 4688571674.80081
 MOROCCO                   |   1993 | 4679496495.11042
 MOROCCO                   |   1992 | 4703600219.20602
 MOZAMBIQUE                |   1998 |  2716348526.8127
 MOZAMBIQUE                |   1997 | 4659746491.26845
 MOZAMBIQUE                |   1996 | 4666981237.54543
 MOZAMBIQUE                |   1995 | 4651540623.63524
 MOZAMBIQUE                |   1994 | 4660631776.48946
 MOZAMBIQUE                |   1993 | 4654145181.19419
 MOZAMBIQUE                |   1992 | 4648271592.45588
 PERU                      |   1998 | 2727026964.39345
 PERU                      |   1997 | 4638283408.86859
 PERU                      |   1996 | 4654819725.09464
 PERU                      |   1995 | 4666619516.89037
 PERU                      |   1994 | 4632907741.44671
 PERU                      |   1993 | 4647467892.66407
 PERU                      |   1992 | 4639832828.40292
 ROMANIA                   |   1998 | 2755786147.66673
 ROMANIA                   |   1997 | 4688000741.07195
 ROMANIA                   |   1996 | 4681382250.17084
 ROMANIA                   |   1995 | 4677089462.80992
 ROMANIA                   |   1994 | 4701314909.06924
 ROMANIA                   |   1993 | 4676657318.32401
 ROMANIA                   |   1992 | 4696171463.05334
 RUSSIA                    |   1998 | 2735989807.83844
 RUSSIA                    |   1997 | 4695600847.82313
 RUSSIA                    |   1996 | 4699163272.15197
 RUSSIA                    |   1995 | 4665112551.81884
 RUSSIA                    |   1994 | 4673750019.94576
 RUSSIA                    |   1993 | 4665713898.01654
 RUSSIA                    |   1992 |  4702893535.8421
 SAUDI ARABIA              |   1998 |  2728862411.0309
 SAUDI ARABIA              |   1997 | 4635591789.45702
 SAUDI ARABIA              |   1996 | 4660845958.24406
 SAUDI ARABIA              |   1995 | 4633167280.33679
 SAUDI ARABIA              |   1994 | 4664147003.59379
 SAUDI ARABIA              |   1993 | 4654357187.22704
 SAUDI ARABIA              |   1992 | 4648117488.29622
 UNITED KINGDOM            |   1998 | 2756963313.95195
 UNITED KINGDOM            |   1997 | 4703727879.75429
 UNITED KINGDOM            |   1996 | 4721619521.50146
 UNITED KINGDOM            |   1995 | 4732387263.61797
 UNITED KINGDOM            |   1994 | 4703174733.46519
 UNITED KINGDOM            |   1993 | 4667329472.67256
 UNITED KINGDOM            |   1992 | 4718612456.86398
 UNITED STATES             |   1998 | 2721613669.93956
 UNITED STATES             |   1997 | 4693518387.98504
 UNITED STATES             |   1996 | 4691755126.32867
 UNITED STATES             |   1995 | 4668135808.08404
 UNITED STATES             |   1994 |  4698059325.3727
 UNITED STATES             |   1993 | 4696373029.31168
 UNITED STATES             |   1992 | 4683029701.69557
 VIETNAM                   |   1998 | 2760309817.09402
 VIETNAM                   |   1997 | 4711245868.02961
 VIETNAM                   |   1996 | 4699754480.04717
 VIETNAM                   |   1995 | 4693878937.68525
 VIETNAM                   |   1994 | 4705118132.04647
 VIETNAM                   |   1993 | 4695835798.84108
 VIETNAM                   |   1992 |  4697241042.7964
(175 rows)

COMMIT;
COMMIT
