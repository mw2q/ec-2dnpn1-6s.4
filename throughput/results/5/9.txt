BEGIN;
BEGIN
select
	nation,
	o_year,
	sum(amount) as sum_profit
from
	(
		select
			n_name as nation,
			extract(year from o_orderdate) as o_year,
			l_extendedprice * (1 - l_discount) - ps_supplycost * l_quantity as amount
		from
			part,
			supplier,
			lineitem,
			partsupp,
			orders,
			nation
		where
			s_suppkey = l_suppkey
			and ps_suppkey = l_suppkey
			and ps_partkey = l_partkey
			and p_partkey = l_partkey
			and o_orderkey = l_orderkey
			and s_nationkey = n_nationkey
			and p_name like '%green%'
	) as profit
group by
	nation,
	o_year
order by
	nation,
	o_year desc;
          nation           | o_year |    sum_profit    
---------------------------+--------+------------------
 ALGERIA                   |   1998 | 2745721393.59243
 ALGERIA                   |   1997 | 4705526532.50294
 ALGERIA                   |   1996 | 4688728655.74297
 ALGERIA                   |   1995 | 4691455007.35553
 ALGERIA                   |   1994 | 4679015911.41409
 ALGERIA                   |   1993 | 4683165801.09189
 ALGERIA                   |   1992 | 4705302649.82692
 ARGENTINA                 |   1998 |  2716917464.1709
 ARGENTINA                 |   1997 | 4646629346.88344
 ARGENTINA                 |   1996 | 4655316758.30121
 ARGENTINA                 |   1995 | 4652982438.35134
 ARGENTINA                 |   1994 | 4647522919.60867
 ARGENTINA                 |   1993 | 4643746056.69086
 ARGENTINA                 |   1992 | 4619567488.39688
 BRAZIL                    |   1998 | 2732179870.92935
 BRAZIL                    |   1997 | 4678365798.64565
 BRAZIL                    |   1996 | 4666624817.80293
 BRAZIL                    |   1995 | 4662279603.85524
 BRAZIL                    |   1994 |  4663951180.3668
 BRAZIL                    |   1993 |  4675308705.9421
 BRAZIL                    |   1992 | 4698295623.45846
 CANADA                    |   1998 | 2736688646.70852
 CANADA                    |   1997 | 4679458788.54972
 CANADA                    |   1996 | 4682828365.97412
 CANADA                    |   1995 | 4682927133.73837
 CANADA                    |   1994 |  4663657371.8263
 CANADA                    |   1993 | 4664738192.37242
 CANADA                    |   1992 |  4692724096.4516
 CHINA                     |   1998 | 2735198893.60299
 CHINA                     |   1997 |  4683787274.3388
 CHINA                     |   1996 | 4694258542.60825
 CHINA                     |   1995 | 4660835842.53514
 CHINA                     |   1994 | 4668485826.38577
 CHINA                     |   1993 | 4655330509.48042
 CHINA                     |   1992 |  4672662676.6356
 EGYPT                     |   1998 | 2730430402.28257
 EGYPT                     |   1997 | 4644203769.77855
 EGYPT                     |   1996 | 4679569005.64209
 EGYPT                     |   1995 | 4659246589.77413
 EGYPT                     |   1994 | 4640820142.50481
 EGYPT                     |   1993 | 4652793333.28992
 EGYPT                     |   1992 | 4653136967.65045
 ETHIOPIA                  |   1998 | 2772133714.91001
 ETHIOPIA                  |   1997 | 4691696891.45371
 ETHIOPIA                  |   1996 | 4699657899.23031
 ETHIOPIA                  |   1995 | 4711810065.19795
 ETHIOPIA                  |   1994 |  4713629366.9822
 ETHIOPIA                  |   1993 | 4674120349.11228
 ETHIOPIA                  |   1992 |  4710726346.8788
 FRANCE                    |   1998 | 2749877002.71931
 FRANCE                    |   1997 | 4692784749.94686
 FRANCE                    |   1996 | 4721522450.75834
 FRANCE                    |   1995 | 4702468767.21771
 FRANCE                    |   1994 | 4701687791.04204
 FRANCE                    |   1993 | 4713934031.17395
 FRANCE                    |   1992 | 4706383784.93261
 GERMANY                   |   1998 | 2767550797.73834
 GERMANY                   |   1997 | 4701736726.24693
 GERMANY                   |   1996 | 4690532255.41517
 GERMANY                   |   1995 | 4684340164.37661
 GERMANY                   |   1994 | 4661426138.47321
 GERMANY                   |   1993 | 4691889864.77562
 GERMANY                   |   1992 | 4692800679.87976
 INDIA                     |   1998 | 2733432684.35941
 INDIA                     |   1997 | 4678443731.99136
 INDIA                     |   1996 | 4673301485.33939
 INDIA                     |   1995 | 4674370612.95474
 INDIA                     |   1994 | 4678109056.78908
 INDIA                     |   1993 | 4643778539.64788
 INDIA                     |   1992 | 4666758878.73182
 INDONESIA                 |   1998 | 2745976673.48015
 INDONESIA                 |   1997 | 4665675909.32318
 INDONESIA                 |   1996 | 4669870217.32467
 INDONESIA                 |   1995 | 4666731228.03417
 INDONESIA                 |   1994 | 4660394132.22491
 INDONESIA                 |   1993 | 4659977902.74639
 INDONESIA                 |   1992 | 4671881521.54619
 IRAN                      |   1998 | 2722708006.80207
 IRAN                      |   1997 | 4610147530.61542
 IRAN                      |   1996 | 4628956630.78662
 IRAN                      |   1995 | 4627198869.32745
 IRAN                      |   1994 |  4610805417.2053
 IRAN                      |   1993 | 4620988459.09423
 IRAN                      |   1992 | 4628501805.12426
 IRAQ                      |   1998 | 2740595869.58912
 IRAQ                      |   1997 | 4664801833.90406
 IRAQ                      |   1996 | 4683564604.16879
 IRAQ                      |   1995 | 4654073599.64256
 IRAQ                      |   1994 | 4687721317.03132
 IRAQ                      |   1993 | 4666989987.20254
 IRAQ                      |   1992 | 4680439916.50038
 JAPAN                     |   1998 | 2724666184.62277
 JAPAN                     |   1997 |  4608313014.0912
 JAPAN                     |   1996 | 4653162800.64988
 JAPAN                     |   1995 | 4663291293.04906
 JAPAN                     |   1994 | 4631330795.98616
 JAPAN                     |   1993 | 4637141580.27078
 JAPAN                     |   1992 | 4655521572.52848
 JORDAN                    |   1998 | 2743925414.99554
 JORDAN                    |   1997 | 4672995805.94518
 JORDAN                    |   1996 | 4668369140.43966
 JORDAN                    |   1995 | 4651163939.11377
 JORDAN                    |   1994 | 4670711195.03165
 JORDAN                    |   1993 |   4674264263.606
 JORDAN                    |   1992 | 4677557935.52847
 KENYA                     |   1998 | 2717293592.60603
 KENYA                     |   1997 | 4608276649.22891
 KENYA                     |   1996 | 4628113942.43721
 KENYA                     |   1995 | 4610970512.24374
 KENYA                     |   1994 |  4617458420.8521
 KENYA                     |   1993 | 4629462669.11344
 KENYA                     |   1992 | 4637728433.83656
 MOROCCO                   |   1998 | 2728936191.29057
 MOROCCO                   |   1997 | 4678416791.80896
 MOROCCO                   |   1996 | 4690778607.74598
 MOROCCO                   |   1995 | 4670557276.77418
 MOROCCO                   |   1994 | 4679463109.64787
 MOROCCO                   |   1993 | 4659785338.69917
 MOROCCO                   |   1992 | 4673705807.71461
 MOZAMBIQUE                |   1998 | 2746139719.75126
 MOZAMBIQUE                |   1997 | 4660239816.04709
 MOZAMBIQUE                |   1996 | 4681434542.26134
 MOZAMBIQUE                |   1995 | 4682079128.82234
 MOZAMBIQUE                |   1994 | 4653069269.65027
 MOZAMBIQUE                |   1993 | 4676966969.52715
 MOZAMBIQUE                |   1992 | 4702009132.48692
 PERU                      |   1998 | 2702176477.97524
 PERU                      |   1997 | 4625620249.30041
 PERU                      |   1996 | 4654724200.54183
 PERU                      |   1995 | 4650009444.67098
 PERU                      |   1994 | 4641341530.36062
 PERU                      |   1993 | 4630041137.83554
 PERU                      |   1992 | 4629915987.50882
 ROMANIA                   |   1998 | 2731336652.16144
 ROMANIA                   |   1997 | 4661670420.29914
 ROMANIA                   |   1996 | 4692864218.29527
 ROMANIA                   |   1995 |  4682555309.0426
 ROMANIA                   |   1994 | 4658291628.68206
 ROMANIA                   |   1993 | 4671608469.75004
 ROMANIA                   |   1992 | 4660220419.48162
 RUSSIA                    |   1998 | 2738030329.20565
 RUSSIA                    |   1997 | 4700644062.38139
 RUSSIA                    |   1996 | 4695709966.83395
 RUSSIA                    |   1995 | 4674207351.39493
 RUSSIA                    |   1994 | 4686045384.39097
 RUSSIA                    |   1993 | 4679301493.96885
 RUSSIA                    |   1992 | 4685135017.22153
 SAUDI ARABIA              |   1998 | 2721742929.82494
 SAUDI ARABIA              |   1997 |   4648047925.978
 SAUDI ARABIA              |   1996 | 4681989716.36239
 SAUDI ARABIA              |   1995 | 4659051168.08766
 SAUDI ARABIA              |   1994 | 4667408347.11814
 SAUDI ARABIA              |   1993 | 4650036672.24848
 SAUDI ARABIA              |   1992 | 4667480949.06462
 UNITED KINGDOM            |   1998 | 2757213153.22263
 UNITED KINGDOM            |   1997 | 4687962020.37174
 UNITED KINGDOM            |   1996 | 4724673961.80866
 UNITED KINGDOM            |   1995 | 4691958918.81318
 UNITED KINGDOM            |   1994 | 4716162309.31871
 UNITED KINGDOM            |   1993 | 4691154821.97969
 UNITED KINGDOM            |   1992 | 4723771540.31821
 UNITED STATES             |   1998 | 2745031672.03108
 UNITED STATES             |   1997 | 4654342698.00628
 UNITED STATES             |   1996 | 4669076614.87733
 UNITED STATES             |   1995 |  4659350006.9761
 UNITED STATES             |   1994 | 4670985742.74032
 UNITED STATES             |   1993 | 4678726483.12359
 UNITED STATES             |   1992 | 4707728194.18293
 VIETNAM                   |   1998 |  2741809714.8929
 VIETNAM                   |   1997 | 4661281065.02117
 VIETNAM                   |   1996 | 4689967383.41876
 VIETNAM                   |   1995 | 4692915464.35815
 VIETNAM                   |   1994 | 4704010245.46962
 VIETNAM                   |   1993 | 4709464701.46336
 VIETNAM                   |   1992 | 4682416625.21659
(175 rows)

COMMIT;
COMMIT
