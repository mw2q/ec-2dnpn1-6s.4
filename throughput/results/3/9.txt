BEGIN;
BEGIN
select
	nation,
	o_year,
	sum(amount) as sum_profit
from
	(
		select
			n_name as nation,
			extract(year from o_orderdate) as o_year,
			l_extendedprice * (1 - l_discount) - ps_supplycost * l_quantity as amount
		from
			part,
			supplier,
			lineitem,
			partsupp,
			orders,
			nation
		where
			s_suppkey = l_suppkey
			and ps_suppkey = l_suppkey
			and ps_partkey = l_partkey
			and p_partkey = l_partkey
			and o_orderkey = l_orderkey
			and s_nationkey = n_nationkey
			and p_name like '%lime%'
	) as profit
group by
	nation,
	o_year
order by
	nation,
	o_year desc;
          nation           | o_year |    sum_profit    
---------------------------+--------+------------------
 ALGERIA                   |   1998 | 2726442604.30403
 ALGERIA                   |   1997 | 4671419987.87582
 ALGERIA                   |   1996 | 4685972615.40467
 ALGERIA                   |   1995 | 4677414851.73189
 ALGERIA                   |   1994 | 4675860479.03652
 ALGERIA                   |   1993 | 4666729434.17085
 ALGERIA                   |   1992 | 4663353327.77783
 ARGENTINA                 |   1998 | 2719055044.87609
 ARGENTINA                 |   1997 | 4646571960.25993
 ARGENTINA                 |   1996 | 4673491708.81074
 ARGENTINA                 |   1995 | 4643928182.99734
 ARGENTINA                 |   1994 | 4633890215.79699
 ARGENTINA                 |   1993 | 4661963186.71987
 ARGENTINA                 |   1992 | 4643871579.31808
 BRAZIL                    |   1998 | 2731575875.19234
 BRAZIL                    |   1997 | 4684088951.30745
 BRAZIL                    |   1996 | 4713980208.18101
 BRAZIL                    |   1995 | 4703607304.46728
 BRAZIL                    |   1994 | 4685110227.55124
 BRAZIL                    |   1993 | 4659953382.47946
 BRAZIL                    |   1992 | 4708103127.19364
 CANADA                    |   1998 |  2751037333.6376
 CANADA                    |   1997 | 4668413446.93784
 CANADA                    |   1996 | 4718433453.70334
 CANADA                    |   1995 | 4685190962.53201
 CANADA                    |   1994 | 4671731576.61173
 CANADA                    |   1993 | 4679107424.15667
 CANADA                    |   1992 | 4712844883.69392
 CHINA                     |   1998 | 2738609659.42485
 CHINA                     |   1997 | 4701721939.23475
 CHINA                     |   1996 | 4689322045.59914
 CHINA                     |   1995 | 4666385338.25358
 CHINA                     |   1994 | 4674453117.79986
 CHINA                     |   1993 | 4681483850.75181
 CHINA                     |   1992 | 4684432264.50399
 EGYPT                     |   1998 | 2754327691.93391
 EGYPT                     |   1997 | 4663687229.77159
 EGYPT                     |   1996 | 4716998812.82441
 EGYPT                     |   1995 | 4642123128.52033
 EGYPT                     |   1994 | 4643303483.19103
 EGYPT                     |   1993 | 4685471086.26028
 EGYPT                     |   1992 | 4654833737.56828
 ETHIOPIA                  |   1998 | 2769265865.44181
 ETHIOPIA                  |   1997 | 4701383923.09372
 ETHIOPIA                  |   1996 | 4707142474.58793
 ETHIOPIA                  |   1995 | 4727172066.71616
 ETHIOPIA                  |   1994 | 4719167375.86967
 ETHIOPIA                  |   1993 | 4711261451.68533
 ETHIOPIA                  |   1992 | 4731765155.97011
 FRANCE                    |   1998 | 2750432854.37532
 FRANCE                    |   1997 | 4699439028.36744
 FRANCE                    |   1996 | 4695376055.90787
 FRANCE                    |   1995 | 4691086690.79445
 FRANCE                    |   1994 | 4702884481.65077
 FRANCE                    |   1993 | 4670776414.10524
 FRANCE                    |   1992 | 4707429533.41296
 GERMANY                   |   1998 | 2754820764.39483
 GERMANY                   |   1997 | 4718074999.28688
 GERMANY                   |   1996 | 4703652452.64813
 GERMANY                   |   1995 | 4717104569.05338
 GERMANY                   |   1994 | 4719353366.93354
 GERMANY                   |   1993 | 4708284893.18708
 GERMANY                   |   1992 |  4708414884.3416
 INDIA                     |   1998 | 2757008721.21283
 INDIA                     |   1997 | 4675617684.07427
 INDIA                     |   1996 | 4689575516.94085
 INDIA                     |   1995 | 4677187183.21077
 INDIA                     |   1994 | 4675767330.97864
 INDIA                     |   1993 | 4651980800.10601
 INDIA                     |   1992 | 4684513389.86347
 INDONESIA                 |   1998 | 2724425902.32162
 INDONESIA                 |   1997 | 4624725385.11475
 INDONESIA                 |   1996 | 4648553486.56987
 INDONESIA                 |   1995 | 4631154459.56097
 INDONESIA                 |   1994 | 4635637210.78193
 INDONESIA                 |   1993 | 4635430747.81303
 INDONESIA                 |   1992 | 4661372790.81418
 IRAN                      |   1998 |  2738150002.3528
 IRAN                      |   1997 | 4698361286.30407
 IRAN                      |   1996 | 4675799581.70185
 IRAN                      |   1995 | 4665259631.97121
 IRAN                      |   1994 | 4655983978.58559
 IRAN                      |   1993 | 4638431949.06331
 IRAN                      |   1992 | 4656805570.25014
 IRAQ                      |   1998 | 2739869294.44456
 IRAQ                      |   1997 | 4641755969.75763
 IRAQ                      |   1996 | 4643263165.58408
 IRAQ                      |   1995 | 4616270258.64977
 IRAQ                      |   1994 | 4626689281.77189
 IRAQ                      |   1993 | 4656840546.81626
 IRAQ                      |   1992 | 4645538436.77901
 JAPAN                     |   1998 | 2702477195.29078
 JAPAN                     |   1997 | 4611878065.69221
 JAPAN                     |   1996 | 4661192170.32082
 JAPAN                     |   1995 | 4646899529.86222
 JAPAN                     |   1994 | 4642191076.88326
 JAPAN                     |   1993 | 4631157736.39514
 JAPAN                     |   1992 | 4641193637.50923
 JORDAN                    |   1998 | 2738538118.21733
 JORDAN                    |   1997 | 4684569908.26463
 JORDAN                    |   1996 | 4704490777.51335
 JORDAN                    |   1995 | 4690483911.80543
 JORDAN                    |   1994 | 4719644258.91148
 JORDAN                    |   1993 | 4692741265.01426
 JORDAN                    |   1992 | 4707615428.04449
 KENYA                     |   1998 | 2715802205.54452
 KENYA                     |   1997 |  4616911197.5892
 KENYA                     |   1996 | 4645126253.33872
 KENYA                     |   1995 | 4606879471.27532
 KENYA                     |   1994 | 4625668528.73099
 KENYA                     |   1993 | 4620489998.17764
 KENYA                     |   1992 | 4632098427.32842
 MOROCCO                   |   1998 | 2733116848.44625
 MOROCCO                   |   1997 | 4678309983.42433
 MOROCCO                   |   1996 | 4685678714.47391
 MOROCCO                   |   1995 | 4695330858.72054
 MOROCCO                   |   1994 | 4690754816.96848
 MOROCCO                   |   1993 | 4683723192.69526
 MOROCCO                   |   1992 | 4691508135.79419
 MOZAMBIQUE                |   1998 | 2743664629.24075
 MOZAMBIQUE                |   1997 | 4683738726.27271
 MOZAMBIQUE                |   1996 | 4684064030.72904
 MOZAMBIQUE                |   1995 | 4654407390.83594
 MOZAMBIQUE                |   1994 | 4673856903.62277
 MOZAMBIQUE                |   1993 | 4661989407.10132
 MOZAMBIQUE                |   1992 | 4660705992.21608
 PERU                      |   1998 | 2706400640.79849
 PERU                      |   1997 | 4626888301.78952
 PERU                      |   1996 | 4628093142.88899
 PERU                      |   1995 | 4623622204.78477
 PERU                      |   1994 | 4622112333.15718
 PERU                      |   1993 | 4614067018.05716
 PERU                      |   1992 | 4637815134.54606
 ROMANIA                   |   1998 | 2740386140.92221
 ROMANIA                   |   1997 | 4682819199.60197
 ROMANIA                   |   1996 | 4690592631.05283
 ROMANIA                   |   1995 | 4690919002.64067
 ROMANIA                   |   1994 | 4671501991.34424
 ROMANIA                   |   1993 |  4652986662.3794
 ROMANIA                   |   1992 | 4684541096.15684
 RUSSIA                    |   1998 | 2718403277.76683
 RUSSIA                    |   1997 | 4654803667.25729
 RUSSIA                    |   1996 |  4686601254.2552
 RUSSIA                    |   1995 | 4667054904.83853
 RUSSIA                    |   1994 |  4674644645.2629
 RUSSIA                    |   1993 |  4658841077.6384
 RUSSIA                    |   1992 | 4677730354.77809
 SAUDI ARABIA              |   1998 | 2734703577.10961
 SAUDI ARABIA              |   1997 | 4668145164.94677
 SAUDI ARABIA              |   1996 |  4673464655.8309
 SAUDI ARABIA              |   1995 | 4667847111.79814
 SAUDI ARABIA              |   1994 | 4667865469.72923
 SAUDI ARABIA              |   1993 | 4692416116.98268
 SAUDI ARABIA              |   1992 | 4648523216.73176
 UNITED KINGDOM            |   1998 | 2748429507.66048
 UNITED KINGDOM            |   1997 | 4687349380.81587
 UNITED KINGDOM            |   1996 | 4699126576.69832
 UNITED KINGDOM            |   1995 | 4708563459.36875
 UNITED KINGDOM            |   1994 |  4685124805.4139
 UNITED KINGDOM            |   1993 | 4673420007.86004
 UNITED KINGDOM            |   1992 | 4695671663.47848
 UNITED STATES             |   1998 | 2748737571.10042
 UNITED STATES             |   1997 | 4663567121.42221
 UNITED STATES             |   1996 | 4663694366.64258
 UNITED STATES             |   1995 | 4653397105.75932
 UNITED STATES             |   1994 | 4681591794.32247
 UNITED STATES             |   1993 | 4654462592.60021
 UNITED STATES             |   1992 | 4681587009.06168
 VIETNAM                   |   1998 | 2744054492.01639
 VIETNAM                   |   1997 | 4674206276.46213
 VIETNAM                   |   1996 |  4695087217.6596
 VIETNAM                   |   1995 | 4678243384.80004
 VIETNAM                   |   1994 | 4699188099.42116
 VIETNAM                   |   1993 | 4696030222.75775
 VIETNAM                   |   1992 | 4695916999.92393
(175 rows)

COMMIT;
COMMIT
