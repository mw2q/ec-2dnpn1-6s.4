BEGIN;
BEGIN
select
	nation,
	o_year,
	sum(amount) as sum_profit
from
	(
		select
			n_name as nation,
			extract(year from o_orderdate) as o_year,
			l_extendedprice * (1 - l_discount) - ps_supplycost * l_quantity as amount
		from
			part,
			supplier,
			lineitem,
			partsupp,
			orders,
			nation
		where
			s_suppkey = l_suppkey
			and ps_suppkey = l_suppkey
			and ps_partkey = l_partkey
			and p_partkey = l_partkey
			and o_orderkey = l_orderkey
			and s_nationkey = n_nationkey
			and p_name like '%khaki%'
	) as profit
group by
	nation,
	o_year
order by
	nation,
	o_year desc;
          nation           | o_year |    sum_profit    
---------------------------+--------+------------------
 ALGERIA                   |   1998 | 2728929077.28677
 ALGERIA                   |   1997 | 4646783821.17515
 ALGERIA                   |   1996 |  4670221836.4877
 ALGERIA                   |   1995 | 4679180741.92798
 ALGERIA                   |   1994 | 4665635439.31013
 ALGERIA                   |   1993 | 4655997722.16245
 ALGERIA                   |   1992 | 4664239460.78109
 ARGENTINA                 |   1998 | 2722993046.84897
 ARGENTINA                 |   1997 | 4651943638.83761
 ARGENTINA                 |   1996 |  4678094061.3088
 ARGENTINA                 |   1995 | 4638675175.66304
 ARGENTINA                 |   1994 | 4637438014.33904
 ARGENTINA                 |   1993 | 4651989459.14994
 ARGENTINA                 |   1992 |  4650629756.8825
 BRAZIL                    |   1998 |  2745311534.8433
 BRAZIL                    |   1997 | 4704062769.46671
 BRAZIL                    |   1996 | 4686591044.02467
 BRAZIL                    |   1995 | 4689308030.36927
 BRAZIL                    |   1994 | 4673528782.75054
 BRAZIL                    |   1993 | 4690264920.50431
 BRAZIL                    |   1992 | 4676915253.90996
 CANADA                    |   1998 | 2743572256.18866
 CANADA                    |   1997 |  4676882899.9543
 CANADA                    |   1996 | 4661963379.66392
 CANADA                    |   1995 | 4664221187.88474
 CANADA                    |   1994 | 4670855564.58315
 CANADA                    |   1993 | 4659654000.58529
 CANADA                    |   1992 | 4662294196.92197
 CHINA                     |   1998 | 2746301883.72354
 CHINA                     |   1997 | 4682091175.19609
 CHINA                     |   1996 | 4687114783.90248
 CHINA                     |   1995 | 4646184345.33013
 CHINA                     |   1994 | 4660509714.79126
 CHINA                     |   1993 |  4684090727.7685
 CHINA                     |   1992 | 4689024878.45361
 EGYPT                     |   1998 | 2730132374.38503
 EGYPT                     |   1997 | 4683632870.19534
 EGYPT                     |   1996 | 4692392249.66897
 EGYPT                     |   1995 | 4678431085.34605
 EGYPT                     |   1994 | 4681278446.17547
 EGYPT                     |   1993 | 4668151620.12315
 EGYPT                     |   1992 | 4694073745.61193
 ETHIOPIA                  |   1998 | 2778430763.53383
 ETHIOPIA                  |   1997 | 4727927462.44947
 ETHIOPIA                  |   1996 | 4738933672.70104
 ETHIOPIA                  |   1995 | 4734296095.52444
 ETHIOPIA                  |   1994 | 4745763524.58036
 ETHIOPIA                  |   1993 | 4739749174.76036
 ETHIOPIA                  |   1992 | 4769028329.38279
 FRANCE                    |   1998 |  2734657898.5168
 FRANCE                    |   1997 | 4709880684.07679
 FRANCE                    |   1996 | 4740137766.89283
 FRANCE                    |   1995 | 4680650098.72927
 FRANCE                    |   1994 | 4686161083.22343
 FRANCE                    |   1993 | 4669800469.68396
 FRANCE                    |   1992 | 4687939735.43036
 GERMANY                   |   1998 |   2756867891.982
 GERMANY                   |   1997 | 4698471099.37286
 GERMANY                   |   1996 | 4685392870.24366
 GERMANY                   |   1995 | 4688961271.80215
 GERMANY                   |   1994 | 4680283809.92035
 GERMANY                   |   1993 | 4675336155.18646
 GERMANY                   |   1992 | 4702900377.94645
 INDIA                     |   1998 | 2736344631.02048
 INDIA                     |   1997 | 4670065038.93803
 INDIA                     |   1996 | 4685727570.14731
 INDIA                     |   1995 | 4641990441.71476
 INDIA                     |   1994 | 4656997587.84161
 INDIA                     |   1993 | 4660812920.80052
 INDIA                     |   1992 | 4683830775.99782
 INDONESIA                 |   1998 | 2733180464.93936
 INDONESIA                 |   1997 | 4626840610.58881
 INDONESIA                 |   1996 | 4653004596.56901
 INDONESIA                 |   1995 | 4624794340.28688
 INDONESIA                 |   1994 | 4640941734.54787
 INDONESIA                 |   1993 | 4635068468.23105
 INDONESIA                 |   1992 | 4661069357.49463
 IRAN                      |   1998 | 2721052134.16167
 IRAN                      |   1997 | 4660638322.74153
 IRAN                      |   1996 | 4653539915.89549
 IRAN                      |   1995 | 4634182112.56833
 IRAN                      |   1994 | 4650887034.91136
 IRAN                      |   1993 | 4645650951.29072
 IRAN                      |   1992 | 4655238367.22893
 IRAQ                      |   1998 | 2758393783.01652
 IRAQ                      |   1997 | 4679590958.74844
 IRAQ                      |   1996 | 4662720620.04088
 IRAQ                      |   1995 | 4666135787.30635
 IRAQ                      |   1994 | 4654470075.01389
 IRAQ                      |   1993 | 4670401626.83031
 IRAQ                      |   1992 | 4675588377.70729
 JAPAN                     |   1998 | 2697059961.26315
 JAPAN                     |   1997 | 4608789645.76983
 JAPAN                     |   1996 | 4627237026.29501
 JAPAN                     |   1995 | 4600337330.98927
 JAPAN                     |   1994 | 4601193645.06617
 JAPAN                     |   1993 | 4605441322.72601
 JAPAN                     |   1992 | 4613916859.85804
 JORDAN                    |   1998 | 2736870041.57554
 JORDAN                    |   1997 | 4658278466.52942
 JORDAN                    |   1996 | 4678135180.63693
 JORDAN                    |   1995 | 4672256812.55688
 JORDAN                    |   1994 | 4680993872.85527
 JORDAN                    |   1993 | 4669922618.04451
 JORDAN                    |   1992 |  4668271971.8771
 KENYA                     |   1998 | 2698004575.83661
 KENYA                     |   1997 | 4604636219.53842
 KENYA                     |   1996 | 4623669797.95381
 KENYA                     |   1995 |  4622393885.4698
 KENYA                     |   1994 | 4623025761.94777
 KENYA                     |   1993 | 4623528392.30446
 KENYA                     |   1992 | 4616629924.65171
 MOROCCO                   |   1998 | 2777962799.11074
 MOROCCO                   |   1997 | 4710327391.58921
 MOROCCO                   |   1996 | 4716977893.01022
 MOROCCO                   |   1995 | 4677528716.99738
 MOROCCO                   |   1994 | 4703208591.09099
 MOROCCO                   |   1993 | 4698766696.71614
 MOROCCO                   |   1992 | 4716578315.77033
 MOZAMBIQUE                |   1998 | 2732366335.28876
 MOZAMBIQUE                |   1997 | 4660006871.23964
 MOZAMBIQUE                |   1996 | 4669217469.60741
 MOZAMBIQUE                |   1995 | 4664481209.35534
 MOZAMBIQUE                |   1994 | 4646605929.19203
 MOZAMBIQUE                |   1993 |   4661856074.917
 MOZAMBIQUE                |   1992 | 4654914403.51072
 PERU                      |   1998 | 2706700631.01785
 PERU                      |   1997 | 4608547524.55596
 PERU                      |   1996 | 4617234190.80839
 PERU                      |   1995 | 4630570598.71758
 PERU                      |   1994 | 4664164485.69487
 PERU                      |   1993 | 4615345263.12366
 PERU                      |   1992 | 4634360003.66397
 ROMANIA                   |   1998 | 2738362939.72547
 ROMANIA                   |   1997 |  4666120363.1015
 ROMANIA                   |   1996 | 4685733009.57464
 ROMANIA                   |   1995 | 4663723416.30433
 ROMANIA                   |   1994 | 4663235964.38487
 ROMANIA                   |   1993 | 4664190033.49377
 ROMANIA                   |   1992 | 4686415602.28316
 RUSSIA                    |   1998 | 2746409204.71638
 RUSSIA                    |   1997 | 4672911316.07667
 RUSSIA                    |   1996 | 4684615143.22348
 RUSSIA                    |   1995 | 4687161691.94661
 RUSSIA                    |   1994 | 4669944886.80716
 RUSSIA                    |   1993 | 4662761369.26478
 RUSSIA                    |   1992 | 4683337295.87521
 SAUDI ARABIA              |   1998 | 2731792107.25747
 SAUDI ARABIA              |   1997 | 4672736052.37606
 SAUDI ARABIA              |   1996 | 4680081321.97991
 SAUDI ARABIA              |   1995 | 4670142312.88661
 SAUDI ARABIA              |   1994 | 4667322482.66741
 SAUDI ARABIA              |   1993 | 4688228778.21186
 SAUDI ARABIA              |   1992 | 4676379391.06613
 UNITED KINGDOM            |   1998 | 2741235626.00694
 UNITED KINGDOM            |   1997 | 4678291083.81252
 UNITED KINGDOM            |   1996 |  4681126773.6777
 UNITED KINGDOM            |   1995 | 4687124912.55789
 UNITED KINGDOM            |   1994 | 4718361418.37344
 UNITED KINGDOM            |   1993 | 4678799285.40587
 UNITED KINGDOM            |   1992 |  4710421089.1805
 UNITED STATES             |   1998 | 2734123933.47685
 UNITED STATES             |   1997 | 4704007052.34747
 UNITED STATES             |   1996 | 4689971991.05335
 UNITED STATES             |   1995 | 4691671896.66551
 UNITED STATES             |   1994 | 4686122220.27726
 UNITED STATES             |   1993 | 4703596777.50055
 UNITED STATES             |   1992 | 4707263128.87827
 VIETNAM                   |   1998 |  2752187712.3275
 VIETNAM                   |   1997 | 4655161471.04034
 VIETNAM                   |   1996 | 4678481702.04747
 VIETNAM                   |   1995 | 4675885251.10489
 VIETNAM                   |   1994 | 4691010493.88779
 VIETNAM                   |   1993 | 4672262473.34029
 VIETNAM                   |   1992 | 4684246533.92057
(175 rows)

COMMIT;
COMMIT
